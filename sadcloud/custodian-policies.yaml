policies:
  - name: enforce-s3-bucket-privacy
    resource: s3
    description: |
      Ensure that no S3 buckets are publicly accessible. This policy
      will identify any bucket that has public access and remove the
      public access by updating the bucket's ACL and bucket policy.
    filters:
      - or:
          - type: global-grants
          - type: check-public-block
            BlockPublicAcls: false
            BlockPublicPolicy: false
          - type: bucket-policy
            key: Statement
            op: contains
            value:
              Effect: Allow
              Principal: "*"
              Action: "s3:*"
    actions:
      - type: set-public-block
        BlockPublicAcls: true
        IgnorePublicAcls: true
        BlockPublicPolicy: true
        RestrictPublicBuckets: true
      - type: remove-statements
        statement_ids:
          - PublicAccess
      - type: notify
        to:
          - slack
        transport:
          type: slack
          url: "https://hooks.slack.com/services/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"
        subject: "S3 Bucket Privacy Alert: Bucket Made Private"
        message: |
          S3 bucket {resource[BucketName]} in account {account_id} 
          was found to be publicly accessible and has had public access removed.

          Cloud Custodian automatically enforced bucket privacy by removing public access.
